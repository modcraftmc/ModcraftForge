--- a/net/minecraft/network/play/ServerPlayNetHandler.java
+++ b/net/minecraft/network/play/ServerPlayNetHandler.java
@@ -8,8 +8,14 @@
 import io.netty.util.concurrent.GenericFutureListener;
 import it.unimi.dsi.fastutil.ints.Int2ShortMap;
 import it.unimi.dsi.fastutil.ints.Int2ShortOpenHashMap;
+
+import java.nio.file.Files;
+import java.nio.file.Paths;
+import java.text.DecimalFormat;
 import java.util.Collections;
 import java.util.Set;
+import java.util.concurrent.ExecutorService;
+import java.util.concurrent.Executors;
 import javax.annotation.Nullable;
 import net.minecraft.advancements.Advancement;
 import net.minecraft.advancements.CriteriaTriggers;
@@ -89,17 +95,7 @@
 import net.minecraft.network.play.client.CUpdateSignPacket;
 import net.minecraft.network.play.client.CUpdateStructureBlockPacket;
 import net.minecraft.network.play.client.CUseEntityPacket;
-import net.minecraft.network.play.server.SChangeBlockPacket;
-import net.minecraft.network.play.server.SChatPacket;
-import net.minecraft.network.play.server.SConfirmTransactionPacket;
-import net.minecraft.network.play.server.SDisconnectPacket;
-import net.minecraft.network.play.server.SHeldItemChangePacket;
-import net.minecraft.network.play.server.SKeepAlivePacket;
-import net.minecraft.network.play.server.SMoveVehiclePacket;
-import net.minecraft.network.play.server.SPlayerPositionLookPacket;
-import net.minecraft.network.play.server.SQueryNBTResponsePacket;
-import net.minecraft.network.play.server.SSetSlotPacket;
-import net.minecraft.network.play.server.STabCompletePacket;
+import net.minecraft.network.play.server.*;
 import net.minecraft.potion.Effects;
 import net.minecraft.server.MinecraftServer;
 import net.minecraft.tileentity.CommandBlockLogic;
@@ -129,6 +125,8 @@
 import net.minecraft.world.IWorldReader;
 import net.minecraft.world.dimension.DimensionType;
 import net.minecraft.world.server.ServerWorld;
+import net.minecraftforge.modcraftforge.common.ModcraftConfig;
+import net.minecraftforge.modcraftforge.common.theading.ModcraftThreadBox;
 import org.apache.logging.log4j.LogManager;
 import org.apache.logging.log4j.Logger;
 
@@ -167,6 +165,13 @@
    private int field_184347_F;
    private int field_184348_G;
 
+   //ModcraftForge
+   private int tickCount = 0;
+   private StringTextComponent header;
+   private StringTextComponent footer;
+
+   private static final DecimalFormat TIME_FORMATTER = new DecimalFormat("########0.000");
+
    public ServerPlayNetHandler(MinecraftServer p_i1530_1_, NetworkManager p_i1530_2_, ServerPlayerEntity p_i1530_3_) {
       this.field_147367_d = p_i1530_1_;
       this.field_147371_a = p_i1530_2_;
@@ -221,6 +226,7 @@
 
       this.field_147367_d.func_213185_aS().func_76320_a("keepAlive");
       long i = Util.func_211177_b();
+
       if (i - this.field_194402_f >= 15000L) {
          if (this.field_194403_g) {
             this.func_194028_b(new TranslationTextComponent("disconnect.timeout"));
@@ -245,8 +251,58 @@
          this.func_194028_b(new TranslationTextComponent("multiplayer.disconnect.idling"));
       }
 
+      if (++tickCount > ModcraftConfig.getRefreshRate()) {
+         tickCount = 0;
+         refreshTab();
+      }
+
    }
 
+   public void refreshTab() {
+
+      double meanTickTime = mean(this.field_147367_d.field_71311_j) * 1.0E-6D;
+      double meanTPS = Math.min(1000.0/meanTickTime, 20);
+
+      header = new StringTextComponent(ModcraftConfig.getCustomheader()
+              .replaceAll("%TPS%", TIME_FORMATTER.format(meanTPS))
+              .replaceAll("%TICKTIME%", TIME_FORMATTER.format(meanTickTime) + "MS")
+              .replaceAll("%ONLINE%", String.valueOf(field_147367_d.func_184103_al().func_72394_k()))
+              .replaceAll("%MAX%", String.valueOf(field_147367_d.func_184103_al().func_72352_l()))
+              .replaceAll("%PING%", String.valueOf(field_147369_b.field_71138_i)));
+
+
+
+      footer = new StringTextComponent(ModcraftConfig.getCustomFooter()
+              .replaceAll("%TPS%", TIME_FORMATTER.format(meanTPS))
+              .replaceAll("%TICKTIME%", TIME_FORMATTER.format(meanTickTime) + "MS")
+              .replaceAll("%ONLINE%", String.valueOf(field_147367_d.func_184103_al().func_72394_k()))
+              .replaceAll("%MAX%", String.valueOf(field_147367_d.func_184103_al().func_72352_l()))
+              .replaceAll("%PING%", String.valueOf(field_147369_b.field_71138_i)));
+
+      field_147369_b.field_71135_a.func_147359_a(new SPlayerListHeaderFooterPacket(header, footer));
+   }
+
+   static String replaceAll( String str, String target, String replacement ) {
+      int targetLength = target.length();
+      if( targetLength == 0 ) {
+         return str;
+      }
+      int idx2 = str.indexOf( target );
+      if( idx2 < 0 ) {
+         return str;
+      }
+      StringBuilder buffer = new StringBuilder( targetLength > replacement.length() ? str.length() : str.length() * 2 );
+      int idx1 = 0;
+      do {
+         buffer.append( str, idx1, idx2 );
+         buffer.append( replacement );
+         idx1 = idx2 + targetLength;
+         idx2 = str.indexOf( target, idx1 );
+      } while( idx2 > 0 );
+      buffer.append( str, idx1, str.length() );
+      return buffer.toString();
+   }
+
    public void func_184342_d() {
       this.field_184349_l = this.field_147369_b.func_226277_ct_();
       this.field_184350_m = this.field_147369_b.func_226278_cu_();
@@ -336,9 +392,11 @@
             }
 
             entity.func_70080_a(d3, d4, d5, f, f1);
+            this.field_147369_b.func_70080_a(d3, d4, d5, this.field_147369_b.field_70177_z, this.field_147369_b.field_70125_A); // Forge - Resync player position on vehicle moving
             boolean flag2 = serverworld.func_226665_a__(entity, entity.func_174813_aQ().func_186664_h(0.0625D));
             if (flag && (flag1 || !flag2)) {
                entity.func_70080_a(d0, d1, d2, f, f1);
+               this.field_147369_b.func_70080_a(d3, d4, d5, this.field_147369_b.field_70177_z, this.field_147369_b.field_70125_A); // Forge - Resync player position on vehicle moving
                this.field_147371_a.func_179290_a(new SMoveVehiclePacket(entity));
                return;
             }
@@ -713,11 +771,18 @@
 
                      if (!this.field_147369_b.func_184850_K() && (!this.field_147369_b.func_71121_q().func_82736_K().func_223586_b(GameRules.field_223615_r) || !this.field_147369_b.func_184613_cA())) {
                         float f2 = this.field_147369_b.func_184613_cA() ? 300.0F : 100.0F;
+
+                        /*ModcraftForge start
+
+
                         if (d11 - d10 > (double)(f2 * (float)i) && !this.func_217264_d()) {
-                           field_147370_c.warn("{} moved too quickly! {},{},{}", this.field_147369_b.func_200200_C_().getString(), d7, d8, d9);
-                           this.func_147364_a(this.field_147369_b.func_226277_ct_(), this.field_147369_b.func_226278_cu_(), this.field_147369_b.func_226281_cx_(), this.field_147369_b.field_70177_z, this.field_147369_b.field_70125_A);
+                           LOGGER.warn("{} moved too quickly! {},{},{}", this.player.getName().getString(), d7, d8, d9);
+                           this.setPlayerLocation(this.player.getPosX(), this.player.getPosY(), this.player.getPosZ(), this.player.rotationYaw, this.player.rotationPitch);
                            return;
                         }
+
+                       ModcraftForge end
+                         */
                      }
 
                      boolean flag2 = this.func_223133_a(serverworld);
@@ -845,7 +910,9 @@
       Direction direction = blockraytraceresult.func_216354_b();
       this.field_147369_b.func_143004_u();
       if (blockpos.func_177956_o() < this.field_147367_d.func_71207_Z() - 1 || direction != Direction.UP && blockpos.func_177956_o() < this.field_147367_d.func_71207_Z()) {
-         if (this.field_184362_y == null && this.field_147369_b.func_70092_e((double)blockpos.func_177958_n() + 0.5D, (double)blockpos.func_177956_o() + 0.5D, (double)blockpos.func_177952_p() + 0.5D) < 64.0D && serverworld.func_175660_a(this.field_147369_b, blockpos)) {
+         double dist = field_147369_b.func_110148_a(net.minecraft.entity.player.PlayerEntity.REACH_DISTANCE).func_111126_e() + 3;
+         dist *= dist;
+         if (this.field_184362_y == null && this.field_147369_b.func_70092_e((double)blockpos.func_177958_n() + 0.5D, (double)blockpos.func_177956_o() + 0.5D, (double)blockpos.func_177952_p() + 0.5D) < dist && serverworld.func_175660_a(this.field_147369_b, blockpos)) {
             ActionResultType actionresulttype = this.field_147369_b.field_71134_c.func_219441_a(this.field_147369_b, serverworld, itemstack, hand, blockraytraceresult);
             if (actionresulttype.func_226247_b_()) {
                this.field_147369_b.func_226292_a_(hand, true);
@@ -900,7 +967,20 @@
    public void func_147231_a(ITextComponent p_147231_1_) {
       field_147370_c.info("{} lost connection: {}", this.field_147369_b.func_200200_C_().getString(), p_147231_1_.getString());
       this.field_147367_d.func_147132_au();
-      this.field_147367_d.func_184103_al().func_148539_a((new TranslationTextComponent("multiplayer.player.left", this.field_147369_b.func_145748_c_())).func_211708_a(TextFormatting.YELLOW));
+
+      ITextComponent component;
+
+      if (ModcraftConfig.useCustomLoginLogout()) {
+
+         component = new StringTextComponent(String.format(ModcraftConfig.getCustomLogoutMessage(), this.field_147369_b.func_145748_c_().func_150254_d()));
+
+      } else {
+         component = new TranslationTextComponent("multiplayer.player.left", this.field_147369_b.func_145748_c_()).func_211708_a(TextFormatting.YELLOW);
+      }
+
+
+      this.field_147367_d.func_184103_al().func_148539_a(component);
+
       this.field_147369_b.func_71123_m();
       this.field_147367_d.func_184103_al().func_72367_e(this.field_147369_b);
       if (this.func_217264_d()) {
@@ -951,33 +1031,40 @@
 
    public void func_147354_a(CChatMessagePacket p_147354_1_) {
       PacketThreadUtil.func_218796_a(p_147354_1_, this, this.field_147369_b.func_71121_q());
-      if (this.field_147369_b.func_147096_v() == ChatVisibility.HIDDEN) {
-         this.func_147359_a(new SChatPacket((new TranslationTextComponent("chat.cannotSend")).func_211708_a(TextFormatting.RED)));
-      } else {
-         this.field_147369_b.func_143004_u();
-         String s = p_147354_1_.func_149439_c();
-         s = org.apache.commons.lang3.StringUtils.normalizeSpace(s);
 
-         for(int i = 0; i < s.length(); ++i) {
-            if (!SharedConstants.func_71566_a(s.charAt(i))) {
-               this.func_194028_b(new TranslationTextComponent("multiplayer.disconnect.illegal_characters"));
-               return;
-            }
-         }
+      ModcraftThreadBox.CHAT_THREAD.submit(() -> {
 
-         if (s.startsWith("/")) {
-            this.func_147361_d(s);
+         if (this.field_147369_b.func_147096_v() == ChatVisibility.HIDDEN) {
+            this.func_147359_a(new SChatPacket((new TranslationTextComponent("chat.cannotSend")).func_211708_a(TextFormatting.RED)));
          } else {
-            ITextComponent itextcomponent = new TranslationTextComponent("chat.type.text", this.field_147369_b.func_145748_c_(), s);
-            this.field_147367_d.func_184103_al().func_148544_a(itextcomponent, false);
-         }
+            this.field_147369_b.func_143004_u();
+            String s = p_147354_1_.func_149439_c();
+            s = org.apache.commons.lang3.StringUtils.normalizeSpace(s);
 
-         this.field_147374_l += 20;
-         if (this.field_147374_l > 200 && !this.field_147367_d.func_184103_al().func_152596_g(this.field_147369_b.func_146103_bH())) {
-            this.func_194028_b(new TranslationTextComponent("disconnect.spam"));
+            for(int i = 0; i < s.length(); ++i) {
+               if (!SharedConstants.func_71566_a(s.charAt(i))) {
+                  this.func_194028_b(new TranslationTextComponent("multiplayer.disconnect.illegal_characters"));
+                  return;
+               }
+            }
+
+            if (s.startsWith("/")) {
+               this.func_147361_d(s);
+            } else {
+               ITextComponent itextcomponent = new TranslationTextComponent("chat.type.text", this.field_147369_b.func_145748_c_(), net.minecraftforge.common.ForgeHooks.newChatWithLinks(s));
+               itextcomponent = net.minecraftforge.common.ForgeHooks.onServerChatEvent(this, s, itextcomponent);
+               if (itextcomponent == null) return;
+               this.field_147367_d.func_184103_al().func_148544_a(itextcomponent, false);
+            }
+
+            this.field_147374_l += 20;
+            if (this.field_147374_l > 200 && !this.field_147367_d.func_184103_al().func_152596_g(this.field_147369_b.func_146103_bH())) {
+               this.func_194028_b(new TranslationTextComponent("disconnect.spam"));
+            }
+
          }
 
-      }
+      });
    }
 
    private void func_147361_d(String p_147361_1_) {
@@ -1061,6 +1148,7 @@
                this.field_147369_b.func_190775_a(entity, hand);
             } else if (p_147340_1_.func_149565_c() == CUseEntityPacket.Action.INTERACT_AT) {
                Hand hand1 = p_147340_1_.func_186994_b();
+               if (net.minecraftforge.common.ForgeHooks.onInteractEntityAt(field_147369_b, entity, p_147340_1_.func_179712_b(), hand1) != null) return;
                ActionResultType actionresulttype = entity.func_184199_a(this.field_147369_b, p_147340_1_.func_179712_b(), hand1);
                if (actionresulttype.func_226247_b_()) {
                   this.field_147369_b.func_226292_a_(hand1, true);
@@ -1094,7 +1182,7 @@
                return;
             }
 
-            this.field_147369_b = this.field_147367_d.func_184103_al().func_72368_a(this.field_147369_b, DimensionType.field_223227_a_, false);
+            this.field_147369_b = this.field_147367_d.func_184103_al().func_72368_a(this.field_147369_b, this.field_147369_b.field_71093_bK, false);
             if (this.field_147367_d.func_71199_h()) {
                this.field_147369_b.func_71033_a(GameType.SPECTATOR);
                this.field_147369_b.func_71121_q().func_82736_K().func_223585_a(GameRules.field_223613_p).func_223570_a(false, this.field_147367_d);
@@ -1268,6 +1356,8 @@
    }
 
    public void func_147349_a(CCustomPayloadPacket p_147349_1_) {
+      PacketThreadUtil.func_218796_a(p_147349_1_, this, this.field_147369_b.func_71121_q());
+      net.minecraftforge.fml.network.NetworkHooks.onCustomPayload(p_147349_1_, this.field_147371_a);
    }
 
    public void func_217263_a(CSetDifficultyPacket p_217263_1_) {
@@ -1283,4 +1373,12 @@
          this.field_147367_d.func_213209_d(p_217261_1_.func_218776_b());
       }
    }
+
+   private static long mean(long[] values)
+   {
+      long sum = 0L;
+      for (long v : values)
+         sum += v;
+      return sum / values.length;
+   }
 }
